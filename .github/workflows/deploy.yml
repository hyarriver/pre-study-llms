name: 自动部署到服务器

on:
  push:
    branches:
      - main  # 或 master，根据你的主分支名称调整
    paths-ignore:
      - '**.md'
      - '.gitignore'
      - 'README.md'

jobs:
  deploy:
    name: 部署到服务器
    runs-on: ubuntu-latest
    
    steps:
      - name: 检查代码
        uses: actions/checkout@v4
      
      - name: 通过SSH部署
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_SSH_KEY }}
          port: ${{ secrets.SERVER_PORT || 22 }}
          script: |
            cd ${{ secrets.PROJECT_PATH }}
            git fetch origin
            git reset --hard origin/main
            cd backend
            pip install -r requirements.txt --quiet
            cd ../web
            npm install --silent
            npm run build
            cd ..
            # 重启服务（根据你的实际部署方式调整）
            # systemctl restart dive-into-llms-backend
            # systemctl restart dive-into-llms-frontend
            # 或
            # pm2 restart all
            # 或
            # docker-compose restart
            echo "部署完成: $(date)"
      
     
